var refresh; //실시간 주문목록 새로고침 관련 변수

//이달의 대장남 페이지
$(document).on("pageshow","#empDjnPage",function(){
    djnRead("init",0);
});

//개인정보 확인 페이지
$(document).on("pageshow","#empSetupConfirmPage",function(){
	setupConfirm();
});

//마에피이지 관리자 메인 페이지
$(document).on("pageshow","#empMyPageMainPage",function(){
	shipngTypeList();
});

//주문 취소 목록 페이지
$(document).on("pageshow","#empOrdrCancelListPage",function(){
	ordrCancelList();
});

//배송 목록 페이지
$(document).on("pageshow","#empShipngListPage",function(){
	shipngList();
});

//주문 취소 상세 페이지
$(document).on("pageshow","#empOrdrCancelReadPage",function(){
	ordrCancelRead();
});


//주문 상세 조회 페이지
$(document).on("pageshow","#empOrdrReadPage",function(){
	ordrRead();
});

//실시간 주문목록 페이지
$(document).on("pageshow","#empRealTimeOrdrListPage",function(){
	realTimeOrdr();
});


//개인정보 관리 상세 조회 페이지
$(document).on("pageshow","#empSetupReadPage",function(){
	setupRead();
});

//직원추천 목록조회 페이지
$(document).on("pageshow","#empRecmndListPage",function(){
	recmndList();
})

function djnRead(type,num){
	var now = new Date();
    var year = $('#year').val();
    var mon = $('#mon').val();
    var selectMon;
    var exam = /^[0]/;
    
	if(type=='init'){
		year= now.getFullYear();
		mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
		$('#year').val(year);
		$('#mon').val(mon);
		selectMon = year + "-" + mon;
	    $('#curntMon').text(year+"년 "+mon+"월");
	}
	else{
		if(type=='year'){
			if(num=='-1'){
				year = parseInt(year)-1;
				$('#year').val(year);
			}
			else{
				year = parseInt(year)+1;
				$('#year').val(year);
			}
		}
		else{
			if((mon=='01'&&num=='-1') || (mon=='12'&&num=='1')){
				alert("월 선택은 1월에서 12월까지 가능합니다.");
				return false;
			}
			else{
				mon = exam.test(mon) ? mon.replace('0','') : mon;
				if(num=='-1'){
					mon = parseInt(mon)-1;
					mon = mon>9 ? mon : '0'+mon;
					$('#mon').val(mon);
				}
				else{
					mon = parseInt(mon)+1;
					mon = mon>9 ? mon : '0'+mon;
					$('#mon').val(mon);
				}
			}
		}
		selectMon = year + "-" + mon;
		$('#curntMon').text(year+"년 "+mon+"월");
	}	
	sessionStorage.setItem('selectMon', selectMon);
	
    $.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/empDjnRead.do",   
      data:{"selectMon":selectMon},
      success:function(data){
		  var djnVo = data.djnVo2;
		  var djnPointPerct = data.djnPointPerct;
		  alert("djnVo="+djnVo);
		  alert("djnPointPerct="+djnPointPerct);
		  if(djnVo.empNme == null){
			  $('#empNme').html("없음");
			  $('#empDuty').html("없음");
			  $('#djnPointPerct').html("없음");
		  }
		  else{
			  var empSeq = djnVo.empSeq;
			  var empNme = djnVo.empNme;
			  var empDuty = djnVo.empDuty;
			  var empTask = djnVo.empTask;
			  var imgRot = djnVo.empImg;
			  
			  var empRecmnd = djnPointPerct.empRecmnd;
			  var custmrRecmnd = djnPointPerct.custmrRecmnd;
			  var custmrPrais = djnPointPerct.custmrPrais;
			  var deliCont = djnPointPerct.deliCont;		 
			  
			  sessionStorage.setItem('chartEmpSeq', empSeq);
			  		  
			  $('#empNme').html(empNme);
			  $('#empDuty').html(empDuty + " / " + empTask);
			  $('#djnPointPerct').html("칭찬합시다 " + custmrPrais + "% / 고객추천 " + custmrRecmnd + "%<br>배달횟수 " + deliCont + "% / 직원추천 " + empRecmnd + "%");  
		  }
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
	google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);
}

// 차트를 그리는 메서드
function drawChart() {
	alert("드로우시작");
	var empSeq = sessionStorage.getItem('chartEmpSeq');
	var selectMon = sessionStorage.getItem('selectMon');
	
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/recmndResn.do",   
      data:{"empSeq":empSeq, "selectMon":selectMon},
      success:function(data){
    	  alert("데이터가져옴");
    	  var arr = new Array(data.length+1); // 매개변수는 배열의 크기
    	  for (var i=0; i<data.length+1; i++) {
    		if(i==0){
    			arr[i] = new Array("기준","비율");
    		}
    		else{
    			arr[i] = new Array(2); // 매개변수는 배열의 크기
    		}
    	  }
    	  $.each(data, function(i, vo){
	    	  var recmndResnCont = vo.recmndResnCont;
	    	  var recmndResn = vo.recmndResn;
	    	  alert("포문");
	    	  if(recmndResnCont!='undefined'){
	    		  arr[i+1][0] = recmndResn;
		    	  arr[i+1][1] = recmndResnCont;
	    	  }
    	  })
		var w = window.innerWidth*0.85;
		var h = window.innerHeight*0.25;
		var option = {width:w, height:h,pieSliceText: 'label', legend:{position:'bottom'}};
		var data = google.visualization.arrayToDataTable(arr);
		var chart = new google.visualization.PieChart(document.getElementById('empDjnChart'));
		chart.draw(data, option);
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}

//실시간 주문 목록 자동 새로고침
function refreshRealTimeOrdrList(){
	$.ajax({
        type: "POST",
        url:"http://192.168.0.20:9011/empRealTimeOrdrList.do",  
        success:function(data){
        	$('#empRealTimeOrdrListFrame').empty();
        	$.each(data, function(i, vo){
      		  var ordrNumbrSeq = vo.ordrNumbrSeq;
      		  var ordrDat = vo.ordrDat;
      		  var ordrStat = vo.ordrStat;
      		  var prodctNme = vo.prodctNme;
      		  var cartImg1 = vo.cartImg1;
      		  var recvrMobl = vo.recvrMobl;
      		  var ordrProdctAmont = vo.ordrProdctAmont;
      		  var allPric = numberWithCommas(vo.allPric);
      		  if(ordrStat=='주문접수'){
	      		  $('#empRealTimeOrdrListFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
	      				  					+ "<table>"
	      				  					+ "<tr>"
	      				  					+ "<td>"+ordrDat+"</td>"
	      				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
	      				  					+ "</td>"
	      				  					+ "</tr>"
	      				  					+ "</table>"
	      				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
	      				  					+ "<div class='row'>"
	      				  					+ "<div class='col-xs-5'>"
	      				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
	      				  					+ "</div>"
	      				  					+ "<div class='col-xs-7'>"
	      				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
	      				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
	      				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "<div class='ui-grid-a ui-responsive'>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat(2,"+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>배송 실시</a></div>"	  
	      				  					+ "</div>"
	      		  )	
      		  }
      		  else{
      			$('#empRealTimeOrdrListFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
		  					+ "<table>"
		  					+ "<tr>"
		  					+ "<td>"+ordrDat+"</td>"
		  					+ "<td style='float:right'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>취소상세보기 ></a>"
		  					+ "</td>"
		  					+ "</tr>"
		  					+ "</table>"
		  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
		  					+ "<div class='row'>"
		  					+ "<div class='col-xs-5'>"
		  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
		  					+ "</div>"
		  					+ "<div class='col-xs-7'>"
		  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
		  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
		  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
      			)	
      		  }
      	  });
  		  $("#empRealTimeOrdrListFrame").listview("refresh");
        },
        error:function(request,status,error){
           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
     });
	//실시간 공동구매 조회
	$.ajax({
        type: "POST",
        url:"http://192.168.0.20:9011/empDahamgaeRealTimeOrdrList.do",  
        success:function(data){
        	$('#empRealTimeOrdrListFrame2').empty();
        	$.each(data, function(i, vo){
      		  var ordrNumbrSeq = vo.ordrNumbrSeq;
      		  var ordrDat = vo.ordrDat;
      		  var ordrStat = vo.ordrStat;
      		  var prodctNme = vo.prodctNme;
      		  var cartImg1 = vo.cartImg1;
      		  var recvrMobl = vo.recvrMobl;
      		  var allPric = numberWithCommas(vo.allPric);
      		  if(ordrStat=='주문접수'){
	      		  $('#empRealTimeOrdrListFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
	      				  					+ "<table>"
	      				  					+ "<tr>"
	      				  					+ "<td>"+ordrDat+"</td>"
	      				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
	      				  					+ "</td>"
	      				  					+ "</tr>"
	      				  					+ "</table>"
	      				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
	      				  					+ "<div class='row'>"
	      				  					+ "<div class='col-xs-5'>"
	      				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
	      				  					+ "</div>"
	      				  					+ "<div class='col-xs-7'>"
	      				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
	      				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
	      				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "<div class='ui-grid-a ui-responsive'>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat(2,"+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>배송 실시</a></div>"
	      				  					+ "</div>"
	      		  )	
      		  }
      		  else{
      			$('#empRealTimeOrdrListFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
		  					+ "<table>"
		  					+ "<tr>"
		  					+ "<td>"+ordrDat+"</td>"
		  					+ "<td style='float:right'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>취소상세보기 ></a>"
		  					+ "</td>"
		  					+ "</tr>"
		  					+ "</table>"
		  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
		  					+ "<div class='row'>"
		  					+ "<div class='col-xs-5'>"
		  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
		  					+ "</div>"
		  					+ "<div class='col-xs-7'>"
		  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
		  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
		  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
      			)	
      		  }
      	  });
  		  $("#empRealTimeOrdrListFrame2").listview("refresh");
        },
        error:function(request,status,error){
           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
     });
}


//숫자 세자리마다 콤마 넣기
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

//주문내역 상세조회 이동
function empOrdrRead(ordrNumbrSeq,ordrType){
	sessionStorage.setItem('ordrNumbrSeq', ordrNumbrSeq);
	sessionStorage.setItem('ordrType', ordrType); //0은 일반, 1은 공동구매
	$.mobile.changePage("../emp/EmpOrdrRead.html");
}

//주문상세조회
function ordrRead(){
	var ordrNumbrSeq = sessionStorage.getItem('ordrNumbrSeq');
	var ordrType = sessionStorage.getItem('ordrType');
	if(ordrType == 0){
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/empOrdrRead.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq, "ordrType":ordrType},
	      success:function(vo){
			  var ordrNumbrSeq = vo.ordrNumbrSeq;
			  var ordrDat = vo.ordrDat;
			  var recvrNme = vo.recvrNme;
			  var nme = vo.empNme;
			  var empMobl = vo.empMobl;
			  var recvrMobl = vo.recvrMobl;
			  var recvrAddrss = vo.recvrAddrss;
			  var recvrAddrssURI = "http://local.daum.net/map/index.jsp?q="+encodeURI(recvrAddrss);
			  var allPric = numberWithCommas(vo.allPric);
			  var hopDelvrDat = vo.hopDelvrDat;
			  var ordrStatSeq = vo.ordrStatSeq;
			  var cartImg1 = vo.cartImg1;
			  $('#ordrDat').text(ordrDat);
			  $('#ordrNumbrSeq').text("주문번호 "+ordrNumbrSeq);
			  switch (ordrStatSeq) {
				case 1:
					$('#ordrStatSeq').text("주문완료");
					break;
				case 2:
					$('#ordrStatSeq').text("배송중");
					break;
				case 3:
					$('#ordrStatSeq').text("배송완료");
				break;
			  }
			  $('#recvrNme').val(recvrNme);
			  $('#map').attr("onclick", "window.open('"+recvrAddrssURI+"', '_system');");
			  $('#recvrAddrss').val(recvrAddrss);
			  $('#hopDelvrDat').val(hopDelvrDat);
			  $('#allPric').val(allPric+"원");
			  $('#recvrMobl').val(recvrMobl);
			  $('#nme').val(nme);
			  $('#empMobl').val(empMobl);
			  $('#cartImg1').attr('src',cartImg1);
			  sessionStorage.removeItem('ordrNumbrSeq');
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
	}
	else{
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/empOrdrRead.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq, "ordrType":ordrType},
	      success:function(vo){
			  var ordrNumbrSeq = vo.ordrNumbrSeq;
			  var ordrDat = vo.ordrDat;
			  var recvrNme = vo.recvrNme;
			  var nme = vo.empNme;
			  var empMobl = vo.empMobl;
			  var recvrMobl = vo.recvrMobl;
			  var recvrAddrss = vo.recvrAddrss;
			  var recvrAddrssURI = "http://local.daum.net/map/index.jsp?q="+encodeURI(recvrAddrss);
			  var allPric = numberWithCommas(vo.allPric);
			  var hopDelvrDat = vo.hopDelvrDat;
			  var ordrStatSeq = vo.ordrStatSeq;
			  var cartImg1 = vo.cartImg1;
			  $('#ordrDat').text(ordrDat);
			  $('#ordrNumbrSeq').text("주문번호 "+ordrNumbrSeq);
			  switch (ordrStatSeq) {
				case 1:
					$('#ordrStatSeq').text("주문완료");
					break;
				case 2:
					$('#ordrStatSeq').text("배송중");
					break;
				case 3:
					$('#ordrStatSeq').text("배송완료");
				break;
			  }
			  $('#recvrNme').val(recvrNme);
			  $('#map').attr("onclick", "window.open('"+recvrAddrssURI+"', '_system');");
			  $('#recvrAddrss').val(recvrAddrss);
			  $('#hopDelvrDat').val(hopDelvrDat);
			  $('#allPric').val(allPric+"원");
			  $('#recvrMobl').val(recvrMobl);
			  $('#nme').val(nme);
			  $('#empMobl').val(empMobl);
			  $('#cartImg1').attr('src',cartImg1);
			  sessionStorage.removeItem('ordrNumbrSeq');
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
	}
}

//실시간 주문목록 조회
function realTimeOrdr(){
	refresh = setInterval(function(){refreshRealTimeOrdrList()},10000); //10초마다 새로고침
	$.ajax({
        type: "POST",
        url:"http://192.168.0.20:9011/empRealTimeOrdrList.do",  
        success:function(data){
        	$.each(data, function(i, vo){
      		  var ordrNumbrSeq = vo.ordrNumbrSeq;
      		  var ordrDat = vo.ordrDat;
      		  var ordrStat = vo.ordrStat;
      		  var prodctNme = vo.prodctNme;
      		  var cartImg1 = vo.cartImg1;
      		  var recvrMobl = vo.recvrMobl;
      		  var ordrProdctAmont = vo.ordrProdctAmont;
      		  var allPric = numberWithCommas(vo.allPric);
      		  if(ordrStat=='주문접수'){
	      		  $('#empRealTimeOrdrListFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
	      				  					+ "<table>"
	      				  					+ "<tr>"
	      				  					+ "<td>"+ordrDat+"</td>"
	      				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
	      				  					+ "</td>"
	      				  					+ "</tr>"
	      				  					+ "</table>"
	      				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
	      				  					+ "<div class='row'>"
	      				  					+ "<div class='col-xs-5'>"
	      				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
	      				  					+ "</div>"
	      				  					+ "<div class='col-xs-7'>"
	      				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
	      				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
	      				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "<div class='ui-grid-a ui-responsive'>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat(2,"+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>배송 실시</a></div>"	  
	      				  					+ "</div>"
	      		  )	
      		  }
      		  else{
      			$('#empRealTimeOrdrListFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
		  					+ "<table>"
		  					+ "<tr>"
		  					+ "<td>"+ordrDat+"</td>"
		  					+ "<td style='float:right'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>취소상세보기 ></a>"
		  					+ "</td>"
		  					+ "</tr>"
		  					+ "</table>"
		  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
		  					+ "<div class='row'>"
		  					+ "<div class='col-xs-5'>"
		  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
		  					+ "</div>"
		  					+ "<div class='col-xs-7'>"
		  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
		  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
		  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
      			)	
      		  }
      	  });
  		  $("#empRealTimeOrdrListFrame").listview("refresh");
        },
        error:function(request,status,error){
           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
     });
	//실시간 공동구매 조회
	$.ajax({
        type: "POST",
        url:"http://192.168.0.20:9011/empDahamgaeRealTimeOrdrList.do",  
        success:function(data){
        	$.each(data, function(i, vo){
      		  var ordrNumbrSeq = vo.ordrNumbrSeq;
      		  var ordrDat = vo.ordrDat;
      		  var ordrStat = vo.ordrStat;
      		  var prodctNme = vo.prodctNme;
      		  var cartImg1 = vo.cartImg1;
      		  var recvrMobl = vo.recvrMobl;
      		  var allPric = numberWithCommas(vo.allPric);
      		  if(ordrStat=='주문접수'){
	      		  $('#empRealTimeOrdrListFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
	      				  					+ "<table>"
	      				  					+ "<tr>"
	      				  					+ "<td>"+ordrDat+"</td>"
	      				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
	      				  					+ "</td>"
	      				  					+ "</tr>"
	      				  					+ "</table>"
	      				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
	      				  					+ "<div class='row'>"
	      				  					+ "<div class='col-xs-5'>"
	      				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
	      				  					+ "</div>"
	      				  					+ "<div class='col-xs-7'>"
	      				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
	      				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
	      				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "</div>"
	      				  					+ "<div class='ui-grid-a ui-responsive'>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
	      				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat(2,"+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>배송 실시</a></div>"
	      				  					+ "</div>"
	      		  )	
      		  }
      		  else{
      			$('#empRealTimeOrdrListFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
		  					+ "<table>"
		  					+ "<tr>"
		  					+ "<td>"+ordrDat+"</td>"
		  					+ "<td style='float:right'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>취소상세보기 ></a>"
		  					+ "</td>"
		  					+ "</tr>"
		  					+ "</table>"
		  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
		  					+ "<div class='row'>"
		  					+ "<div class='col-xs-5'>"
		  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
		  					+ "</div>"
		  					+ "<div class='col-xs-7'>"
		  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
		  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
		  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
		  					+ "</div>"
      			)	
      		  }
      	  });
  		  $("#empRealTimeOrdrListFrame2").listview("refresh");
        },
        error:function(request,status,error){
           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
     });
}

//실시간 주문목록 페이지 숨겨지면 새로고침 함수 제거
$(document).on("pagehide","#empRealTimOrdrListPage",function(){
	clearInterval(refresh);
});

//직원추천
function recmndEmp(empSeq){
	var empNme = $('#empSeq'+empSeq).val();
	var getEmpSeq = empSeq;
	var giveEmpSeq = sessionStorage.getItem('empSeq');
	if (confirm(empNme+" 직원을 추천하시겠습니까?") == true){    //확인
		$.ajax({
	        type: "POST",
	        url:"http://192.168.0.20:9011/empRecmndCreate.do",   
	        data:{"getEmpSeq":empSeq, "giveEmpSeq":giveEmpSeq},
	        success:function(data){
	        	if(data==1){
	        		alert("이미 추천을 하셨습니다.");
	        	}
	        	else{
	        		alert("직원 추천이 완료되었습니다.");
	        	}	        	
	        },
	        error:function(request,status,error){
	           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	        }
	     });
	}
	else{   //취소
		alert("추천이 취소되었습니다.");
	}	
}

//직원추천 목록조회
function recmndList(){
	var empSeq = sessionStorage.getItem('empSeq');
    $.ajax({
        type: "POST",
        url:"http://192.168.0.20:9011/empRecmndList.do",   
        data:{"empSeq":empSeq},
        success:function(data){
        	var length = data.length;
        	var source = "<li><div class='font-sm center-xs'><strong>이번 달 추천하고 싶은 동료를 뽑아주세요!<br>투표결과는 '이달의 대장남' 선정에 반영됩니다.</strong></div></li>";
        	$.each(data, function(i, vo){
      		  var nme = vo.nme;
      		  var empSeq = vo.empSeq;
      		  var duty = vo.duty;
      		  var task = vo.task;
      		  var imgRot = vo.imgRot;
      		  if (i%2 == 0){
      			  source = source + "<li><div class='row'>";
      		  }
      		  source = source + "<div class='col-xs-6 center-xs'>"
      		  			+ "<input type='hidden' id='empSeq"+empSeq+"' value='"+nme+"'>"
      		  			+ "<div onclick='javascript:recmndEmp("+empSeq+")'><img src='" + imgRot + "' width='100%' height='100%'></div>"
      		  			+ "<p><strong>" + nme + "</strong></p>"
      		  			+ "<p>" + duty + " / " + task + "</p></div>";
      		  if (i%2 != 0 || (length-1) == i){
      			  source = source + "</div></li>";
      		  }
        	});
        	$('#empRecmndListFrame').append(source);
        	$('#empRecmndListFrame').listview("refresh");
        },
        error:function(request,status,error){
           alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
     });
}

//배송목록조회(주문접수~배송중)
function shipngList(){
	//버튼별 배송조회
	$("input[name='ordrStatSeq']").on("change", function() {
        var ordrStatSeq = $("input[name='ordrStatSeq']:checked").val();
        $.ajax({
            type: "POST",
            url:"http://192.168.0.20:9011/empShipngList.do",   
            data:{"ordrStatSeq":ordrStatSeq},
            success:function(data){
          	  	$('#empShipngFrame').empty();
            	$.each(data, function(i, vo){
          		  var ordrNumbrSeq = vo.ordrNumbrSeq;
          		  var ordrDat = vo.ordrDat;
          		  var ordrStat = vo.ordrStat;
          		  var prodctNme = vo.prodctNme;
          		  var cartImg1 = vo.cartImg1;
          		  var recvrMobl = vo.recvrMobl;
          		  var ordrProdctAmont = vo.ordrProdctAmont;
          		  var allPric = numberWithCommas(vo.allPric);
          		  var shipngStat = "배송 실시";
          		  var shipngCount = 2;
	      		  switch (ordrStat) {
	  				case '배송중':
	  					shipngStat = "배송 완료";
	  					shipngCount = 3;
	  					break;
	  				case '배송완료':
	  					shipngStat = "완료";
	  					shipngCount = 4;
	      		  }
          		  $('#empShipngFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
          				  					+ "<table>"
          				  					+ "<tr>"
          				  					+ "<td>"+ordrDat+"</td>"
          				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
          				  					+ "</td>"
          				  					+ "</tr>"
          				  					+ "</table>"
          				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
          				  					+ "<div class='row'>"
          				  					+ "<div class='col-xs-5'>"
          				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
          				  					+ "</div>"
          				  					+ "<div class='col-xs-7'>"
          				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
          				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
          				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "<div class='ui-grid-a ui-responsive'>"
          				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
          				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat("+shipngCount+","+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>"+shipngStat+"</a></div>"	  
          				  					+ "</div>"
          		  )	
          	  });
      		  $("#empShipngFrame").listview("refresh");
      		  sessionStorage.removeItem('ordrStatSeq');
            },
            error:function(request,status,error){
               alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            }
         });
	});
	$("input[name='ordrStatSeq2']").on("change", function() {
        var ordrStatSeq = $("input[name='ordrStatSeq2']:checked").val();
        //버튼별 공동구매 배송목록 조회
        $.ajax({
            type: "POST",
            url:"http://192.168.0.20:9011/empDahamgaeShipngList.do",   
            data:{"ordrStatSeq":ordrStatSeq},
            success:function(data){
          	  	$('#empShipngFrame2').empty();
            	$.each(data, function(i, vo){
          		  var ordrNumbrSeq = vo.ordrNumbrSeq;
          		  var ordrDat = vo.ordrDat;
          		  var ordrStat = vo.ordrStat;
          		  var prodctNme = vo.prodctNme;
          		  var cartImg1 = vo.cartImg1;
          		  var recvrMobl = vo.recvrMobl;
          		  var allPric = numberWithCommas(vo.allPric);
          		  var shipngStat = "배송 실시";
          		  var shipngCount = 2;
	      		  switch (ordrStat) {
	  				case '배송중':
	  					shipngStat = "배송 완료";
	  					shipngCount = 3;
	  					break;
	  				case '배송완료':
	  					shipngStat = "완료";
	  					shipngCount = 4;
	      		  }
          		  $('#empShipngFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
          				  					+ "<table>"
          				  					+ "<tr>"
          				  					+ "<td>"+ordrDat+"</td>"
          				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
          				  					+ "</td>"
          				  					+ "</tr>"
          				  					+ "</table>"
          				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
          				  					+ "<div class='row'>"
          				  					+ "<div class='col-xs-5'>"
          				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
          				  					+ "</div>"
          				  					+ "<div class='col-xs-7'>"
          				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
          				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
          				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "</div>"
          				  					+ "<div class='ui-grid-a ui-responsive'>"
          				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
          				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat("+shipngCount+","+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>"+shipngStat+"</a></div>"	  
          				  					+ "</div>"
          		  )	
          	  });
      		  $("#empShipngFrame2").listview("refresh");
      		  sessionStorage.removeItem('ordrStatSeq');
            },
            error:function(request,status,error){
               alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            }
         });
	});
	//페이지 처음 조회
	var ordrStatSeq = sessionStorage.getItem('ordrStatSeq');
	switch (ordrStatSeq) {
	case '0':
		$("#ordrStatAll").prop('checked',true).checkboxradio('refresh');
		$("#ordrStatAll2").prop('checked',true).checkboxradio('refresh');
		break;
	case '1':
		$("#ordrStatAccept").prop('checked',true).checkboxradio('refresh');
		$("#ordrStatAccept2").prop('checked',true).checkboxradio('refresh');
		break;
	case '2':
		$("#ordrStatShipng").prop('checked',true).checkboxradio('refresh');
		$("#ordrStatShipng2").prop('checked',true).checkboxradio('refresh');
		break;
	case '3':
		$("#ordrStatFinish").prop('checked',true).checkboxradio('refresh');
		$("#ordrStatFinish2").prop('checked',true).checkboxradio('refresh');
		break;
	}
	//일반 배송목록 조회
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/empShipngList.do",   
      data:{"ordrStatSeq":ordrStatSeq},
      success:function(data){
    	  $.each(data, function(i, vo){
    		  var ordrNumbrSeq = vo.ordrNumbrSeq;
    		  var ordrDat = vo.ordrDat;
    		  var ordrStat = vo.ordrStat;
    		  var prodctNme = vo.prodctNme;
    		  var cartImg1 = vo.cartImg1;
    		  var recvrMobl = vo.recvrMobl;
    		  var ordrProdctAmont = vo.ordrProdctAmont;
    		  var allPric = numberWithCommas(vo.allPric);
    		  var shipngStat = "배송 실시";
      		  var shipngCount = 2;
      		  switch (ordrStat) {
  				case '배송중':
  					shipngStat = "배송 완료";
  					shipngCount = 3;
  					break;
  				case '배송완료':
  					shipngStat = "완료";
  					shipngCount = 4;
      		  }
    		  $('#empShipngFrame').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
    				  					+ "<table>"
    				  					+ "<tr>"
    				  					+ "<td>"+ordrDat+"</td>"
    				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",0)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
    				  					+ "</td>"
    				  					+ "</tr>"
    				  					+ "</table>"
    				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
    				  					+ "<div class='row'>"
    				  					+ "<div class='col-xs-5'>"
    				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
    				  					+ "</div>"
    				  					+ "<div class='col-xs-7'>"
    				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
    				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + " 외 " + ordrProdctAmont + "건 </div>"
    				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "<div class='ui-grid-a ui-responsive'>"
    				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
    				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat("+shipngCount+","+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>"+shipngStat+"</a></div>"	  
    				  					+ "</div>"
    		  )	
    	  });
		  $("#empShipngFrame").listview("refresh");
		  sessionStorage.removeItem('ordrStatSeq');
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
	//공동구매 배송목록 조회
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/empDahamgaeShipngList.do",   
      data:{"ordrStatSeq":ordrStatSeq},
      success:function(data){
    	  $.each(data, function(i, vo){
    		  var ordrNumbrSeq = vo.ordrNumbrSeq;
    		  var ordrDat = vo.ordrDat;
    		  var ordrStat = vo.ordrStat;
    		  var prodctNme = vo.prodctNme;
    		  var cartImg1 = vo.cartImg1;
    		  var recvrMobl = vo.recvrMobl;
    		  var allPric = numberWithCommas(vo.allPric);
    		  var shipngStat = "배송 실시";
      		  var shipngCount = 2;
      		  switch (ordrStat) {
  				case '배송중':
  					shipngStat = "배송 완료";
  					shipngCount = 3;
  					break;
  				case '배송완료':
  					shipngStat = "완료";
  					shipngCount = 4;
      		  }
    		  $('#empShipngFrame2').append("<div data-role='content' style='padding-left:0px; padding-right:0px;'>"
    				  					+ "<table>"
    				  					+ "<tr>"
    				  					+ "<td>"+ordrDat+"</td>"
    				  					+ "<td style='float:right'><a onclick='empOrdrRead("+ordrNumbrSeq+",1)' class='ui-btn ui-btn-inline clr-btn-accent-light-green'>주문상세보기 ></a>"
    				  					+ "</td>"
    				  					+ "</tr>"
    				  					+ "</table>"
    				  					+ "<div data-role='content' style='border:1px solid #8BC34A;'>"
    				  					+ "<div class='row'>"
    				  					+ "<div class='col-xs-5'>"
    				  					+ "<img src='" + cartImg1 + "' style='max-width:100%; max-height:100%'>"
    				  					+ "</div>"
    				  					+ "<div class='col-xs-7'>"
    				  					+ "<p><a href='#' class='ui-btn font-btn' style='background-color:#F3F3F3; border:1px solid #D5D5D5'>"+ordrStat+"</a></p>"
    				  					+ "<div style='text-overflow:ellipsis; overflow:hidden; white-space:nowrap;'>"+ prodctNme + "</div>"
    				  					+ "<h5 style='text-align:right'>"+ allPric + "원</h5>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "</div>"
    				  					+ "<div class='ui-grid-a ui-responsive'>"
    				  					+ "<div style='width:50%; float:left' class='ui-block-a'><a href='tel:" + recvrMobl + "' rel='external' class='ui-btn ui-btn-raised font-btn'>전화 연결</a></div>"
    				  					+ "<div style='width:50%; float:left' class='ui-block-b'><a onclick='updateOrdrStat("+shipngCount+","+ordrNumbrSeq+")' class='ui-btn ui-btn-raised font-btn'>"+shipngStat+"</a></div>"	  
    				  					+ "</div>"
    		  )	
    	  });
		  $("#empShipngFrame2").listview("refresh");
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}

//마이페이지 관리자 - 배송조회 각각 조회
function selectShipngList(ordrStatSeq){
	switch (ordrStatSeq) {
	case 0: //전체조회
		sessionStorage.setItem('ordrStatSeq', 0);
		$.mobile.changePage("../emp/EmpShipngList.html");
		break;
	case 1: //주문완료
		sessionStorage.setItem('ordrStatSeq', 1);
		$.mobile.changePage("../emp/EmpShipngList.html");
		break;
	case 2: //배송중
		sessionStorage.setItem('ordrStatSeq', 2);
		$.mobile.changePage("../emp/EmpShipngList.html");
		break;
	case 3: //배송완료
		sessionStorage.setItem('ordrStatSeq', 3);
		$.mobile.changePage("../emp/EmpShipngList.html");
		break;
	}
}

//배송 상태 변경
function updateOrdrStat(shipngCount, ordrNumbrSeq){
	var empSeq = sessionStorage.getItem('empSeq');
	var sendTlt;
	var sendMsg;
	var d = new Date();
    var time = d.getFullYear() + "년 " + (d.getMonth() + 1) + "월 " + d.getDate() + "일 " + d.getHours() + "시 " + d.getMinutes() + "분";
   
	switch (shipngCount) {
	case 2:
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/ordrStatUpdate.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq, "empSeq":empSeq},
	      success:function(data){
	    	  sendTlt = "배송 시작 알림";
	    	  sendMsg = time + "에 배송이 시작되었습니다.";
	    	  alert("배송중으로 상태가 변경되었습니다.");
		  		$.ajax({
		  	      type: "POST",
		  	      data:{"ordrNumbrSeq":ordrNumbrSeq, "sendTlt":sendTlt, "sendMsg":sendMsg},
		  	      url:"http://192.168.0.20:9011/pushOrdrStat.do",   
		  	      success:function(data){
		  	    	  
		  	      },
		  	      error:function(request,status,error){
		  	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		  	      }
		  	   });
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
		$.mobile.changePage(window.location.href, {
	        allowSamePageTransition: true,
	        transition: 'none',
	        reloadPage: true
	    });
		break;
	case 3:
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/ordrStatUpdate.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq, "empSeq":0},
	      success:function(data){
	    	  alert("배송 완료로 상태가 변경되었습니다.");
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
		$.mobile.changePage(window.location.href, {
	        allowSamePageTransition: true,
	        transition: 'none',
	        reloadPage: true
	    });
		break;
	case 4:
		alert("모든 과정이 완료되었습니다.");
		break;
	}	
}

//주문 취소 상세조회 이동
function empOrdrCancelRead(ordrNumbrSeq, ordrType){
	sessionStorage.setItem('ordrNumbrSeq', ordrNumbrSeq);
	sessionStorage.setItem('ordrType', ordrType);
	$.mobile.changePage("../emp/EmpOrdrCancelRead.html");
}


//주문 취소 상세 조회
function ordrCancelRead(){
	var ordrNumbrSeq = sessionStorage.getItem('ordrNumbrSeq');
	var ordrType = sessionStorage.getItem('ordrType');
	if(ordrType==0){ //일반 상품
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/empOrdrCancelRead.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq},
	      success:function(ordrMap){
	    	  var vo = ordrMap.empOrdrVo;
	    	  var list = ordrMap.ordrCancelProdctList;
	    	  
			  var ordrNumbrSeq = vo.ordrNumbrSeq;
			  var ordrDat = vo.ordrDat;
			  var ordrPamntDat = vo.ordrPamntDat;
			  var recvrNme = vo.recvrNme;
			  var recvrMobl = vo.recvrMobl;
			  var recvrAddrss = vo.recvrAddrss;
			  var recvrDetlAddrss = vo.recvrDetlAddrss;
			  var allPric = numberWithCommas(vo.allPric);
			  var ordrCanlDat = vo.ordrCanlDat;
			  var source = "<li style='background:#F6F6F6'><font style='float:left' size='2'>"+ordrDat+"</font><font style='float:right' size='2'>주문번호 "+ordrNumbrSeq+"</font></li>";
			  $.each(list, function(i, vo){
				  var prodctNme = vo.prodctNme;
				  var ordrAmont = vo.ordrAmont;
				  var selPric = vo.selPric;
				  var mainImg = vo.mainImg;
				  source = source + "<li class='li-border'><img src='" + mainImg + "'><p>" + prodctNme + "</p><p>수량 " + ordrAmont + "개 / " + selPric + "원</p></li>";				  				    		  
			  });
			  source = source + "<li><div data-role='content' style='border-bottom: 1px dashed'>"
			  			+ "<p>총 취소 금액 <font style='float:right' size='4'><strong>" + allPric + "원</strong></font></p></div></li>"
			  			+ "<li><p><strong>결제 날짜</strong><font style='float:right'>"+ordrPamntDat+"</font></p>"
			  			+ "<p><strong>취소 날짜</strong><font style='float:right'>" + ordrCanlDat + "</font></p>"
			  			+ "<p><strong>받는 사람</strong><font style='float:right'>" + recvrNme + "</font></p>"
			  			+ "<p><strong>전화번호</strong><font style='float:right'>" + recvrMobl + "</font></p>" 
			  			+ "<p><strong>고객 주소</strong><font style='float:right'>" + recvrAddrss + "</font></p>"
			  			+ "<p><font style='float:right'>" + recvrDetlAddrss + "</font></p></li>"
			  $('#empOrdrCancelReadList').append(source);	
			  $("#empOrdrCancelReadList").listview("refresh");	  
			  sessionStorage.removeItem('ordrNumbrSeq');
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
	}
	else{ //공동구매 상품
		$.ajax({
	      type: "POST",
	      url:"http://192.168.0.20:9011/empDahamgaeOrdrCancelRead.do",   
	      data:{"ordrNumbrSeq":ordrNumbrSeq},
	      success:function(ordrMap){
	    	  var vo = ordrMap.empOrdrVo;
	    	  var list = ordrMap.ordrCancelProdctList;
	    	  
			  var ordrNumbrSeq = vo.ordrNumbrSeq;
			  var ordrDat = vo.ordrDat;
			  var ordrPamntDat = vo.ordrPamntDat;
			  var recvrNme = vo.recvrNme;
			  var recvrMobl = vo.recvrMobl;
			  var recvrAddrss = vo.recvrAddrss;
			  var recvrDetlAddrss = vo.recvrDetlAddrss;
			  var allPric = numberWithCommas(vo.allPric);
			  var ordrCanlDat = vo.ordrCanlDat;
			  var source = "<li style='background:#F6F6F6'><font style='float:left' size='2'>"+ordrDat+"</font><font style='float:right' size='2'>주문번호 "+ordrNumbrSeq+"</font></li>";
			  $.each(list, function(i, vo){
				  var prodctNme = vo.prodctNme;
				  var ordrAmont = vo.ordrAmont;
				  var selPric = vo.selPric;
				  var mainImg = vo.mainImg;
				  source = source + "<li class='li-border'><img src='" + mainImg + "'><p>" + prodctNme + "</p><p>수량 " + ordrAmont + "개 / " + selPric + "원</p></li>";				  				    		  
			  });
			  source = source + "<li><div data-role='content' style='border-bottom: 1px dashed'>"
			  			+ "<p>총 취소 금액 <font style='float:right' size='4'><strong>" + allPric + "원</strong></font></p></div></li>"
			  			+ "<li><p><strong>결제 날짜</strong><font style='float:right'>"+ordrPamntDat+"</font></p>"
			  			+ "<p><strong>취소 날짜</strong><font style='float:right'>" + ordrCanlDat + "</font></p>"
			  			+ "<p><strong>받는 사람</strong><font style='float:right'>" + recvrNme + "</font></p>"
			  			+ "<p><strong>전화번호</strong><font style='float:right'>" + recvrMobl + "</font></p>" 
			  			+ "<p><strong>고객 주소</strong><font style='float:right'>" + recvrAddrss + "</font></p>"
			  			+ "<p><font style='float:right'>" + recvrDetlAddrss + "</font></p></li>"
			  $('#empOrdrCancelReadList').append(source);	
			  $("#empOrdrCancelReadList").listview("refresh");	  
			  sessionStorage.removeItem('ordrNumbrSeq');
	      },
	      error:function(request,status,error){
	         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	      }
	   });
	}
}

//주문취소 목록조회
function ordrCancelList(){
	//일반 목록
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/ordrCancelList.do",   
      success:function(data){
    	  $.each(data, function(i, vo){
    		  var ordrNumbrSeq = vo.ordrNumbrSeq;
    		  var ordrDat = vo.ordrDat;
    		  var prodctNme = vo.prodctNme;
    		  var ordrProdctAmont = vo.ordrProdctAmont;
    		  var allPric = numberWithCommas(vo.allPric);
    		  var ordrCanlDat = vo.ordrCanlDat;
    		  $('#ordrCancelList').append("<li style='background:#F6F6F6'><font style='float:left' size='2'>"+ordrDat+"</font><font style='float:right' size='2' color='red'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",0)'>취소상세보기 ></a></font></li>"
    				  					+ "<li>"+ prodctNme + " 외 " + ordrProdctAmont + "건</li>"
    				  					+ "<li><h5 style='text-align:right'>"+ allPric + "원</h5></li>"
    				  					+ "<li><font size='1'>취소완료 "+ ordrCanlDat + "</font></li>"
    				  					+ "<li><br></li>"
    		  )	
    	  });
		  $("#ordrCancelList").listview("refresh");
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
	//공동구매 목록
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/dahamgaeOrdrCancelList.do",   
      success:function(data){
    	  $.each(data, function(i, vo){
    		  var ordrNumbrSeq = vo.ordrNumbrSeq;
    		  var ordrDat = vo.ordrDat;
    		  var prodctNme = vo.prodctNme;
    		  var allPric = numberWithCommas(vo.allPric);
    		  var ordrCanlDat = vo.ordrCanlDat;
    		  $('#ordrCancelList2').append("<li style='background:#F6F6F6'><font style='float:left' size='2'>"+ordrDat+"</font><font style='float:right' size='2' color='red'><a onclick='empOrdrCancelRead("+ordrNumbrSeq+",1)'>취소상세보기 ></a></font></li>"
    				  					+ "<li>"+ prodctNme + "</li>"
    				  					+ "<li><h5 style='text-align:right'>"+ allPric + "원</h5></li>"
    				  					+ "<li><font size='1'>취소완료 "+ ordrCanlDat + "</font></li>"
    				  					+ "<li><br></li>"
    		  )	
    	  });
		  $("#ordrCancelList2").listview("refresh");
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}

//배송상태별 건수조회
function shipngTypeList(){
	var empSeq = sessionStorage.getItem('empSeq');
	navigator.notification.alert("내용입니다.",alert("됩니까?"),"테스트요","확인!!!!");
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/ordrCountList.do",  
      data:{"empSeq":empSeq},
      success:function(data){
    	  var list = data.ordrCountList;
    	  var empNme = data.empNme;
    	  $.each(list, function(i, vo){
    		 if(i==0){
    			 $('#ordrFinish').text(vo.ordrNumbrCount);
    		 } 
    		 if(i==1){
    			 $('#shipng').text(vo.ordrNumbrCount);
    		 }
    		 if(i==2){
    			 $('#shipngFinish').text(vo.ordrNumbrCount);
    		 }
    	  });
    	  $('#empNme').text(empNme+" 님, 환영합니다!");
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}



//개인정보 관리 아이디 조회
function setupConfirm(){
	var empSeq = sessionStorage.getItem('empSeq');
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/empInfoRead.do",   
      data: {"empSeq":empSeq},
      success:function(data){
    	  $('#empId').val(data.id);
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}

//개인정보 상세조회
function setupRead(){
	var empSeq = sessionStorage.getItem('empSeq');
	$.ajax({
      type: "POST",
      url:"http://192.168.0.20:9011/empInfoRead.do",   
      data: {"empSeq":empSeq},
      success:function(data){
    	  $('#nme').val(data.nme);
    	  $('#id').val(data.id);
    	  $('#mobl').val(data.mobl);
    	  $('#empSeq').val(empSeq);
    	  $('#empSeq2').val(empSeq);
      },
      error:function(request,status,error){
         alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
   });
}

//개인정보 확인값 조회
function selectEmpMyPageInfoCount(){
	var formData = $('#empMyPageSetupConfirmFrm').serialize();
	$.ajax({
		type:"POST",
		data:formData,
		url:"http://192.168.0.20:9011/empInfoConfirmRead.do",
		success:function(data){
			if(data.empCount==1){
				$.mobile.changePage("../emp/EmpMyPageSetupRead.html");				
				sessionStorage.setItem('pw',data.pw);
			}
			else{
				alert("비밀번호를 다시 확인해주세요.");
			}
		},
		error:function(request,status,error){
	        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		}
	});
}	


//마이페이지 관리자 - 환경설정 - 수정,완료버튼 관련 함수
function changeEmpMyPageInfo(){ 
	$('#id').attr('readonly',false);
	$('#nme').attr('readonly',false);
	$('#mobl').attr('readonly',false);
	$('#updateBtn').css('display','none');
	$('#finishBtn').css('display','block');
}

//마이페이지 관리자 - 환경설정 - 수정,완료버튼 관련 함수
function finishEmpMyPageInfo(){ 
	$('#id').attr('readonly',true);
	$('#nme').attr('readonly',true);
	$('#mobl').attr('readonly',true);
	$('#updateBtn').css('display','block');
	$('#finishBtn').css('display','none');
	
	var formData = $('#empMyPageSetupReadFrm').serialize();
	$.ajax({
		type:"POST",
		data:formData,
		url:"http://192.168.0.20:9011/empInfoUpdate.do",
		success:function(data){
			if (confirm("개인 정보가 변경되었습니다. 홈 화면으로 이동하시겠습니까?") == true){    //확인
				$.mobile.changePage("EmpMyPageMain.html");
			}
			else{
				return false;
			}
		},
		error:function(request,status,error){
	        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		}
	});
}

//개인정보 최종 업데이트
function updateEmpMyPageInfo(){
	var formData = $('#empMyPageSetupReadFrm2').serialize();
	var pw = sessionStorage.getItem('pw');
	var curntPw = $('#curntPw').val();
	var newPw = $('#pw').val();
	var newPw2 = $('#pw2').val();
     
	//기존 비밀번호 입력 여부
	if (curntPw == ""){
		alert("현재 비밀번호를 입력해주세요.");
		return false;
	}
	
	//새 비밀번호 입력 여부
	if (newPw == "" || newPw2 == ""){
		alert("새 비밀번호를 입력해주세요.");
		return false;
	}
	
	// 길이
    if(!/^[a-zA-Z0-9!@#$%^&*()?_~]{5,20}$/.test(newPw))
    { 
        alert("비밀번호는 숫자, 영문, 특수문자 조합으로 5~20자리를 사용해야 합니다.");
        $('#pw').val("");
        $('#pw2').val("");
        return false;
    }
     
    // 영문, 숫자, 특수문자 2종 이상 혼용
    var chk = 0;
    if(newPw.search(/[0-9]/g) != -1 ) chk ++;
    if(newPw.search(/[a-z]/ig)  != -1 ) chk ++;
    if(newPw.search(/[!@#$%^&*()?_~]/g)  != -1  ) chk ++;
    if(chk < 2)
    { 
        alert("비밀번호는 숫자, 영문, 특수문자를 두가지이상 혼용하여야 합니다."); 
        $('#pw').val("");
        $('#pw2').val("");
        return false;
    }
     
    // 동일한 문자/숫자 4이상, 연속된 문자
    if(/(\w)\1\1\1/.test(newPw) || isContinuedValue(newPw))
    {
        alert("비밀번호에 4자 이상의 연속 또는 반복 문자 및 숫자를 사용하실 수 없습니다."); 
        $('#pw').val("");
        $('#pw2').val("");
        return false;
    }
    
	// 기존 비밀번호 일치 여부
    if (pw != curntPw){
    	alert("현재 비밀번호가 맞지 않습니다.");
    	return false;
    }
	
	// 기존 비밀번호와 새 비밀번호 일치 여부
    if (curntPw == newPw2) {
        alert("현재 비밀번호와 새 비밀번호는 다르게 설정해야 합니다.");
        return false;
    }    
    
    // 재입력 일치 여부
    if (newPw != newPw2) {
        alert("입력한 두 개의 비밀번호가 서로 일치하지 않습니다.");
        $('#pw').val("");
        $('#pw2').val("");
        return false;
    }
    
	$.ajax({
		type:"POST",
		data:formData,
		url:"http://192.168.0.20:9011/empPwUpdate.do",
		success:function(data){
			alert("비밀번호 수정이 완료되었습니다.");
			sessionStorage.setItem('pw',newPw);
			$.mobile.changePage("EmpMyPageMain.html");
		},
		error:function(request,status,error){
	        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		}
	});
}

function isContinuedValue(value) {
    console.log("value = " + value);
    var intCnt1 = 0;
    var intCnt2 = 0;
    var temp0 = "";
    var temp1 = "";
    var temp2 = "";
    var temp3 = "";

    for (var i = 0; i < value.length-3; i++) {
        console.log("=========================");
        temp0 = value.charAt(i);
        temp1 = value.charAt(i + 1);
        temp2 = value.charAt(i + 2);
        temp3 = value.charAt(i + 3);

        console.log(temp0)
        console.log(temp1)
        console.log(temp2)
        console.log(temp3)

        if (temp0.charCodeAt(0) - temp1.charCodeAt(0) == 1
                && temp1.charCodeAt(0) - temp2.charCodeAt(0) == 1
                && temp2.charCodeAt(0) - temp3.charCodeAt(0) == 1) {
            intCnt1 = intCnt1 + 1;
        }

        if (temp0.charCodeAt(0) - temp1.charCodeAt(0) == -1
                && temp1.charCodeAt(0) - temp2.charCodeAt(0) == -1
                && temp2.charCodeAt(0) - temp3.charCodeAt(0) == -1) {
            intCnt2 = intCnt2 + 1;
        }
        console.log("=========================");
    }

    console.log(intCnt1 > 0 || intCnt2 > 0);
    return (intCnt1 > 0 || intCnt2 > 0);
}